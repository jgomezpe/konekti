{"html":"<div id='·id·' class=\"w3-card ·color·\" style=\"width:·width·;\">\n    ·inner·\n</div>\n<div id='·id·' class=\"w3-bar-item w3-button\" onclick=\"Konekti.client('·tree·').select('·menu·','·id·')\">\n    <i class=\"·icon·\"></i> ·caption·\n</div>\n<div id='·id·-btn'  class=\"w3-dropdown-click w3-hide w3-bar-block \">\n    <div class=\"w3-bar-item w3-button\" onclick=\"Konekti.client('·tree·').drop('·id·')\">\n        <i class=\"fa fa-ellipsis-v\"></i>\n    </div>\n    <div id=\"·id·-drop\" class=\"w3-dropdown-content w3-card\">\n        ·drop·\n    </div>\n</div>\n<div id='·id·' class='w3-bar' icon='·icon·' cicon='·contracticon·'>\n  \t<div class=\"w3-button w3-bar-item \" onclick=\"·run·\">\n        <i id='·id·-icon' class=\"·icon·\"></i> ·caption·\n    </div>\n    ·options·\n</div>\n<div id=\"·id·-inner\" class=\" w3-container w3-hide\">\n    ·inner·\n</div>","js":"Konekti.plugin.tree.replace = 'strict'\n\nclass Tree extends KonektiClient{\n\tconstructor( dictionary ){\n\t\tsuper(dictionary)\n\t\tdictionary.select = dictionary.select || 'select'\n\t\tdictionary.sel_color = dictionary.sel_color || \" w3-green\"\n\t}\n\t\n\tupdate( id ){\n        if( this.current !== undefined ){\n            var cx = Konekti.vc(this.current)\n            cx.className = cx.className.replace(this.dictionary.sel_color, ' ')\n            var ceb = Konekti.vc(this.current+'-btn')\n            if( ceb !== undefined && ceb !== null){\n                var xd = Konekti.vc(id+'-drop');\n                if (xd.className.indexOf(\"w3-show\") != -1)\n                    xd.className = xd.className.replace(\" w3-show\", \"\")\n                ceb.className = ceb.className.replace('w3-show', 'w3-hide')\n                ceb.className = ceb.className.replace(this.dictionary.sel_color, ' ')\n            }    \n        }\n        this.current = id\n        \n        var x = Konekti.vc(id);\n        x.className += this.dictionary.sel_color\n        var eb = Konekti.vc(id+'-btn');\n        if( eb !== undefined && eb !== null){\n            eb.className += this.dictionary.sel_color\n            eb.className = eb.className.replace('w3-hide', 'w3-show')\n        }\n\t}\n\t\n\tdrop( id ){\n        var x = Konekti.vc(id+'-drop');\n        if (x.className.indexOf(\"w3-show\") == -1) {\n            x.className += \" w3-show\";\n        } else { \n            x.className = x.className.replace(\" w3-show\", \"\")\n        }\n\t}\n\t\n\tselect( id, option ){\n        var c = Konekti.client(this.dictionary.client)\n        if( typeof c != 'undefined' && c[this.dictionary.select] !== undefined ) \n            c[this.dictionary.select](id, option)\n        this.update(id)\n\t}\n\n    expand( id ){\n        var c = Konekti.client(this.dictionary.client)\n        if( typeof c != 'undefined' && typeof c.expand != 'undefined' ) c.expand(id)\n        this.update(id)\n        var x = Konekti.vc(id);\n        var b = Konekti.vc(id+'-icon')\n        var i = Konekti.vc(id+'-inner')\n        if(i.className.indexOf('w3-show') == -1){ \n            i.className = i.className.replace('w3-hide', 'w3-show')\n            b.className = x.getAttribute('cicon')\n        }else{\n            i.className = i.className.replace('w3-show', 'w3-hide')\n            b.className = x.getAttribute('icon')\n        }    \n    }    \n}\n\nKonekti.tree = function(t){\n    Konekti.plugin.tree.replaceWith(t)\n    return new Tree(t)\n}\n\nKonekti.plugin.tree.splitTemplate = function(){\n    var k = this.htmlTemplate.indexOf(\"</div>\\n<div\") + 7\n    var template = this.htmlTemplate.substring(k)\n    this.htmlTemplate = this.htmlTemplate.substring(0,k)\n    k = template.indexOf(\"</div>\\n<div\") + 7\n    this.itemTemplate = template.substring(0,k)\n    template = template.substring(k)\n    k = template.indexOf(\"</div>\\n<div\") + 7\n    this.optionsTemplate = template.substring(0,k)\n    this.innerTemplate = template.substring(k)\n    k = this.innerTemplate.indexOf(\"</div>\\n<div\") + 7\n    this.leafTemplate = this.innerTemplate.substring(0,k)\n}\n\nKonekti.plugin.tree.fillOption = function(tree, id, option){\n    if( option !== undefined ){\n        var optTemplate = ''\n        for( var i=0; i<option.length; i++ ){\n                if( typeof option[i] == 'string'){\n                    option[i] = {\"id\":option[i], \"caption\":option[i]}\n                }\n                option[i].tree = tree\n                option[i].menu = id\n                optTemplate += Konekti.core.fromTemplate(this.itemTemplate, option[i])\n        }\n        var opt = {\"id\":id, \"tree\":tree, \"drop\":optTemplate}\n        return Konekti.core.fromTemplate(this.optionsTemplate, opt)\n    }else return ''\n}\n\nKonekti.plugin.tree.fillLeaf = function(tree, leaf, icon, option){\n    leaf.tree = tree\n    leaf.run = \"Konekti.client('·tree·').select('·id·')\"\n    leaf.run = Konekti.core.fromTemplate(leaf.run, leaf)\n    leaf.icon = leaf.icon || icon\n    option = leaf.option || option\n    leaf.options = this.fillOption(tree, leaf.id, option)\n    return Konekti.core.fromTemplate(this.leafTemplate, leaf)\n}\n\nKonekti.plugin.tree.fillInner = function(tree, inner, icon, option){\n    var id = inner.id\n    var template = ''\n    for( var i=0; i<inner.children.length; i++ ){\n        var child = inner.children[i]\n        if( typeof child === 'string' ) child = {\"id\":child, \"caption\":child}\n        if( child.caption === undefined ) child.caption = child.id\n        if( child.id === undefined ) child.id = child.caption\n        if( child.children !== undefined  ) template += this.fillInner(tree, child, icon, option)\n        else template += this.fillLeaf(tree, child, icon.leaf, option.leaf)\n    }\n    inner.tree = tree\n    inner.run = \"Konekti.client('·tree·').expand('·id·')\"\n    inner.run = Konekti.core.fromTemplate(inner.run, inner)\n    inner.icon = inner.icon || icon.expand\n    inner.contracticon = inner.contracticon || icon.contract\n    inner.inner = template\n    inner.options = this.fillOption(tree, inner.id, option.inner)\n    return Konekti.core.fromTemplate(this.innerTemplate, inner)\n}\n\nKonekti.plugin.tree.fillLayout = function(dictionary){\n    if(this.innerTemplate === undefined || this.innerTemplate === null) this.splitTemplate()\n    var id = dictionary.id\n    dictionary.client = dictionary.client || 'client'\n    var icon = dictionary.icon || {\"leaf\":\"\", \"expand\":\"fa fa-angle-right\", \"contract\":\"fa fa-angle-down\"}\n    var options = dictionary.options || {}\n\n    if( dictionary.tree.caption === undefined ) dictionary.tree.caption = dictionary.tree.id\n    if( dictionary.tree.id === undefined ) dictionary.tree.id = dictionary.tree.caption\n    \n    dictionary.inner = this.fillInner(id, dictionary.tree, icon, options )\n\n    return Konekti.core.fromTemplate(this.htmlTemplate, dictionary)\n}\n"}
