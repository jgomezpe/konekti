<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: ace.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: ace.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/** Konekti Plugin for ACE editors */
class AcePlugIn extends PlugIn{
	/** Creates a Plugin for ACE editors */
	constructor(){
		super('ace')
			this.ready = false
			this.view = []
			this.mode = {}
		}
    
	/**
		* Defines a dynamic language mode taking as basis the OOP mode
		* @param lang Configuration information for the defined language
		*/
	define( lang ){
		var id = lang.mode;
		this.mode[id] = true
		define(
			"ace/mode/"+lang.mode+"_highlight_rules",
			function(require, exports, module) {
				"use strict";
				var oop = require("../lib/oop");
				var TextHighlightRules = require("./text_highlight_rules").TextHighlightRules;
				var EditorHighlightRules = function() {
					this.$rules = lang.tokens;
					this.normalizeRules();
				};
				EditorHighlightRules.metaData = {
					fileTypes: lang.fileTypes,
					foldingStartMarker: '(%\\s*region \\w*)|([a-z]\\w*.*:- ?)',
					foldingStopMarker: '(%\\s*end(\\s*region)?)|(?=\\.)',
					keyEquivalent: '^~P',
					name: lang.qName,
					scopeName: 'source.'+lang.mode
				};
				oop.inherits(EditorHighlightRules, TextHighlightRules);
				exports[id+'HighlightRules'] = EditorHighlightRules;
			}
		);

		define(
			"ace/mode/folding/cstyle",
			function(require, exports, module) {
				"use strict";
				var oop = require("../../lib/oop");
				var Range = require("../../range").Range;
				var BaseFoldMode = require("./fold_mode").FoldMode;
				var FoldMode = exports.FoldMode = function(commentRegex) {
					if (commentRegex) {
						this.foldingStartMarker = new RegExp( this.foldingStartMarker.source.replace(/\|[^|]*?$/, "|" + commentRegex.start) );
						this.foldingStopMarker = new RegExp( this.foldingStopMarker.source.replace(/\|[^|]*?$/, "|" + commentRegex.end) );
					}
				};
				oop.inherits(FoldMode, BaseFoldMode);
				(function() {
					this.foldingStartMarker = /([\{\[\(])[^\}\]\)]*$|^\s*(\/\*)/;
					this.foldingStopMarker = /^[^\[\{\(]*([\}\]\)])|^[\s\*]*(\*\/)/;
					this.singleLineBlockCommentRe= /^\s*(\/\*).*\*\/\s*$/;
					this.tripleStarBlockCommentRe = /^\s*(\/\*\*\*).*\*\/\s*$/;
					this.startRegionRe = /^\s*(\/\*|\/\/)#?region\b/;
					this._getFoldWidgetBase = this.getFoldWidget;
					this.getFoldWidget = function(session, foldStyle, row){
						var line = session.getLine(row);
						if (this.singleLineBlockCommentRe.test(line)){ if (!this.startRegionRe.test(line) &amp;&amp; !this.tripleStarBlockCommentRe.test(line)) return ""; }
						var fw = this._getFoldWidgetBase(session, foldStyle, row);
						if (!fw &amp;&amp; this.startRegionRe.test(line)) return "start"; // lineCommentRegionStart	
						return fw;
					};
					this.getFoldWidgetRange = function(session, foldStyle, row, forceMultiline) {
						var line = session.getLine(row);
						if (this.startRegionRe.test(line)) return this.getCommentRegionBlock(session, line, row);
						var match = line.match(this.foldingStartMarker);
						if (match) {
							var i = match.index;
							if (match[1]) return this.openingBracketBlock(session, match[1], row, i);
							var range = session.getCommentFoldRange(row, i + match[0].length, 1);
							if (range &amp;&amp; !range.isMultiLine()){ 
								if (forceMultiline) { range = this.getSectionRange(session, row); }
								else if (foldStyle != "all") range = null;
							}
							return range;
						}
						if (foldStyle === "markbegin") return;
						var match = line.match(this.foldingStopMarker);
						if (match) {
							var i = match.index + match[0].length;
							if (match[1]) return this.closingBracketBlock(session, match[1], row, i);
							return session.getCommentFoldRange(row, i, -1);
						}
					};
					this.getSectionRange = function(session, row) {
						var line = session.getLine(row);
						var startIndent = line.search(/\S/);
						var startRow = row;
						var startColumn = line.length;
						row = row + 1;
						var endRow = row;
						var maxRow = session.getLength();
						while (++row &lt; maxRow) {
							line = session.getLine(row);
							var indent = line.search(/\S/);
							if (indent === -1) continue;
							if  (startIndent > indent) break;
							var subRange = this.getFoldWidgetRange(session, "all", row);
							if (subRange) {
 								if (subRange.start.row &lt;= startRow) { break; }
								else if (subRange.isMultiLine()) { row = subRange.end.row; } 
								else if (startIndent == indent) { break; }
							}
							endRow = row;
						}
						return new Range(startRow, startColumn, endRow, session.getLine(endRow).length);
					};
					this.getCommentRegionBlock = function(session, line, row) {
						var startColumn = line.search(/\s*$/);
						var maxRow = session.getLength();
						var startRow = row;
						var re = /^\s*(?:\/\*|\/\/|--)#?(end)?region\b/;
						var depth = 1;
						while (++row &lt; maxRow) {
							line = session.getLine(row);
							var m = re.exec(line);
							if (!m) continue;
							if (m[1]) depth--;
							else depth++;
							if (!depth) break;
						}
						var endRow = row;
						if (endRow > startRow) { return new Range(startRow, startColumn, endRow, line.length); }
					};
				}).call(FoldMode.prototype);
			}
		);
		define(
			"ace/mode/"+id,
			function(require, exports, module) {
				"use strict";
				var oop = require("../lib/oop");
				var TextMode = require("./text").Mode;
				var EditorHighlightRules = require("./"+id+"_highlight_rules")[id+'HighlightRules'];
				var FoldMode = require("ace/mode/folding/cstyle").FoldMode;
				var Mode = function() {
					this.HighlightRules = EditorHighlightRules;
					this.foldingRules = new FoldMode();
					this.$behaviour = this.$defaultBehaviour;
				};
				oop.inherits(Mode, TextMode);
				(function() {
					this.lineCommentStart = "%";
					this.blockComment = {start: "/*", end: "*/"};
					this.$id = "ace/mode/"+id;
				}).call(Mode.prototype);
				exports.Mode = Mode;
			}
		);
	}
    
	/**
	 * Registers and defines a dynamic language mode taking as basis the OOP mode
	 * @param lang Configuration information for the defined language
	 * @param edit Ace editor using the language
	 */
	register( lang, edit ){
		var id = lang.mode
		if( this.mode[id] === undefined ) this.define(lang)
		edit.session.setMode("ace/mode/"+id)
	}
    
	/**
	 * Connects components as soon as the ACE library is ready
	 */
	done(){
		while( this.view.length > 0 ){
			var config = this.view[0]
			this.view.shift()
			Konekti.client[config.id].update(config)    
		}
		this.ready = true
	}
    
	/**
	 * Load an ACE editor 
	 * @param config Configuration of the ACE editor
	 */
	load( config ){ 
		this.view.push( config )
		if( this.ready ) this.done()
	}

	/**
	 * Creates a client for the plugin
	 * @param config Instance configuration
	 */
	client(config){ 
		var editor = new Ace(config) 
		if( this.ready ) editor.update(config)
		else this.load( config )
		return editor
	}
}

/** An Ace Editor */
class Ace extends Editor{
	/**
	 * Creates an Ace Editor
	 * @param config Ace editor configuration
	 */
	constructor(config){ super(config) }

	/**
	 * Associated html code
	 * @param config Client configuration
	 */
	html( config ){ return "&lt;div id='"+this.id+"'>&lt;div id='"+this.id+"Ace' style='width:100%;height:100%;'>&lt;/div>&lt;/div>" }
	
	/**
	 * Updates an Ace Editor
	 * @param thing Ace editor configuration
	 */
	update(thing){
		var id = this.id
		var x = this
		x.gui = x.vc('Ace')
		if( x.edit === undefined ){
			x.edit = ace.edit(id+'Ace');
			x.sui = x.gui.getElementsByClassName('ace_scroller')[0]
			x.sbui = x.gui.getElementsByClassName('ace_scrollbar-v')[0].getElementsByClassName('ace_scrollbar-inner')[0]
			x.edit.setFontSize("16px")
			x.edit.setShowPrintMargin(false)

			x.edit.session.on("changeAnnotation", function () {
				var annot = x.edit.session.getAnnotations();
				for( var i=0; i&lt;x.listener.length; i++ ){
					var l = Konekti.client[x.listener[i]]
					if( l != null &amp;&amp; l.annotation != null ) l.annotation(id, annot)
				}             
			});	

			x.gui.getElementsByTagName('textarea')[0].addEventListener('keyup', function(event){ 
				for( var i=0; i&lt;x.listener.length; i++ ){
					var l = Konekti.client[x.listener[i]]
					if( l != null &amp;&amp; l.onkeyup!=null ) l.onkeyup(id, event)
				}
			})
						
			x.edit.session.on('change', function(){ 
				for( var i=0; i&lt;x.listener.length; i++ ){
					var l = Konekti.client[x.listener[i]]
					if( l != null &amp;&amp; l.onchange!=null ) l.onchange(id)
				}
			})
		}    
		
		if(thing.initial !== undefined){
			x.edit.setValue(thing.initial,1)
		}

		if( thing.theme !== undefined &amp;&amp; thing.theme!==null) x.edit.setTheme("ace/theme/"+thing.theme)

		if( thing.code !== undefined &amp;&amp; thing.code != null ){
			thing.code.cid = id
			thing.code.mode = thing.mode
			Konekti.plugins.ace.register(thing.code, x.edit)
		}else if( thing.mode !== undefined ) x.edit.session.setMode("ace/mode/"+thing.mode)
	}

	/**
	 * Gets current text in the editor
	 * @return Current text in the editor
	 */
	getText(){ return this.edit.getValue() }

	/**
	 * Sets text in the editor
	 * @param txt Text to set in the editor
	 */
	setText(txt){
		var x = this
		function checked(){
			if( x.edit !== undefined ){
				x.edit.focus()
				x.edit.setValue(txt, 1) 
			}else setTimeout( checked, 100 )
		}
		checked()
	}

	/**
	 * Sets current position in the editor
	 * @param row Row for the cursor
	 * @param column Column for the cursor
	 */
	locateCursor(row, column){
		this.edit.moveCursorTo(row, column);
		this.edit.focus();
	}
	
	/**
	 * Gets current position in the editor
	 * @return [row,column] for the cursor
	 */
	cursorLocation(){ return this.edit.selection.getCursor() }

	/**
	 * Highlights a row in the editor
	 * @param row Row to highlight
	 */
	highlight(row){ this.locateCursor( row,1 ) }

	/**
	 * Gets current position in the editor (character count)
	 * @return Position of the cursor (character count)
	 */
	cursorIndex(){ return this.edit.session.doc.positionToIndex(this.edit.selection.getCursor()) }
	
	/**
	 * Sets current position in the editor (character count)
	 * @param pos Position of the cursor (character count)
	 */
	locateCursorIndex(pos){ this.edit.selection.moveTo(this.edit.session.doc.indexToPosition(pos)) }

	/**
	 * Updates the position of the scroll associated to the editor
	 * @param pos New position for the scroll
	 */
	scrollTop(pos){
		var x=this
		var tout
		function check(){
			var h = parseInt(x.sbui.style.height, 10)
			var ls = parseInt(x.sui.style.lineHeight,10)
			var tlines = h/ls
			if(tlines != x.edit.session.getLength() ) tout = setTimeout(check,100)
			else{
				if(typeof pos=='undefined') pos = h
				var line = Math.floor(pos/ls)
				x.edit.scrollToLine(line, true, true, function () {});
				x.edit.gotoLine(line, 0, true);
				clearTimeout(tout)
			}
		}
		check()
	}
}

/** Ace class */
if( Konekti.ace === undefined ) new AcePlugIn()

/**
 * Creates an Ace configuration object
 * @method
 * aceConfig
 * @param id Id of the component that will contain the ace editor
 * @param width Width of the split component
 * @param height Height of the split component
 * @param initial Initial text inside the ace editor
 * @param mode Mode of the ace editor
 * @param theme Theme of the ace editor
 * @param code Lexical configuration for the ace editor  
 * @param parent Parent component
 */
Konekti.aceConfig = function(id, width, height, initial, mode, theme, code, parent='KonektiMain'){
	return {"plugin":"ace", "id":id, "initial":initial, "mode":mode, "theme":theme, "code":code, 'width':width, 'height':height, 'parent':parent}
}

/**
 * Associates/adds an Ace editor component
 * @method
 * ace
 * @param id Id of the component that will contain the ace editor
 * @param width Width of the split component
 * @param height Height of the split component
 * @param initial Initial text inside the ace editor
 * @param mode Mode of the ace editor
 * @param theme Theme of the ace editor
 * @param code Lexical configuration for the ace editor  
 */
Konekti.ace = function(id, width, height, initial, mode, theme, code){
	return Konekti.build(Konekti.aceConfig(id, width, height, initial, mode, theme, code))
}

ACE_PATH = "https://ace.c9.io/build/src/"
Konekti.resource.JS(ACE_PATH+"ace.js", 
	function (){
		function check(){
			if(ace === undefined) setTimeout( check, 100 )
			else{
				ace.config.set('basePath', ACE_PATH)
				ace.config.set('modePath', ACE_PATH)
				ace.config.set('themePath', ACE_PATH)
				ace.config.set('workerPath', ACE_PATH)
				Konekti.plugins.ace.done()
			}
		}
		check()	
	} 
)
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="Accordion.html">Accordion</a></li><li><a href="AccordionPlugIn.html">AccordionPlugIn</a></li><li><a href="Ace.html">Ace</a></li><li><a href="AcePlugIn.html">AcePlugIn</a></li><li><a href="Btn.html">Btn</a></li><li><a href="BtnPlugIn.html">BtnPlugIn</a></li><li><a href="Canvas.html">Canvas</a></li><li><a href="CanvasPlugIn.html">CanvasPlugIn</a></li><li><a href="Client.html">Client</a></li><li><a href="DivClient.html">DivClient</a></li><li><a href="DivPlugIn.html">DivPlugIn</a></li><li><a href="DOM.html">DOM</a></li><li><a href="DropDownPlugIn.html">DropDownPlugIn</a></li><li><a href="Editor.html">Editor</a></li><li><a href="Header.html">Header</a></li><li><a href="HeaderPlugIn.html">HeaderPlugIn</a></li><li><a href="IFrameEditor.html">IFrameEditor</a></li><li><a href="IFramePlugIn.html">IFramePlugIn</a></li><li><a href="Item.html">Item</a></li><li><a href="ItemPlugIn.html">ItemPlugIn</a></li><li><a href="KonektiAPI.html">KonektiAPI</a></li><li><a href="Latex.html">Latex</a></li><li><a href="LatexPlugIn.html">LatexPlugIn</a></li><li><a href="MainClient.html">MainClient</a></li><li><a href="Media.html">Media</a></li><li><a href="MediaClient.html">MediaClient</a></li><li><a href="MediaPlugIn.html">MediaPlugIn</a></li><li><a href="NavBar.html">NavBar</a></li><li><a href="NavBarPlugIn.html">NavBarPlugIn</a></li><li><a href="PlugIn.html">PlugIn</a></li><li><a href="Resource.html">Resource</a></li><li><a href="SideBar.html">SideBar</a></li><li><a href="SideBarPlugIn.html">SideBarPlugIn</a></li><li><a href="SplitClient.html">SplitClient</a></li><li><a href="SplitPlugIn.html">SplitPlugIn</a></li><li><a href="Tab.html">Tab</a></li><li><a href="TabPlugIn.html">TabPlugIn</a></li><li><a href="Youtube.html">Youtube</a></li><li><a href="YoutubePlugIn.html">YoutubePlugIn</a></li></ul><h3>Global</h3><ul><li><a href="global.html#accordion">accordion</a></li><li><a href="global.html#accordionConfig">accordionConfig</a></li><li><a href="global.html#ace">ace</a></li><li><a href="global.html#aceConfig">aceConfig</a></li><li><a href="global.html#audio">audio</a></li><li><a href="global.html#audioConfig">audioConfig</a></li><li><a href="global.html#btn">btn</a></li><li><a href="global.html#btnConfig">btnConfig</a></li><li><a href="global.html#canvas">canvas</a></li><li><a href="global.html#canvasConfig">canvasConfig</a></li><li><a href="global.html#div">div</a></li><li><a href="global.html#divConfig">divConfig</a></li><li><a href="global.html#dropdown">dropdown</a></li><li><a href="global.html#dropdownConfig">dropdownConfig</a></li><li><a href="global.html#header">header</a></li><li><a href="global.html#headerConfig">headerConfig</a></li><li><a href="global.html#iframe">iframe</a></li><li><a href="global.html#iframeConfig">iframeConfig</a></li><li><a href="global.html#Konekti">Konekti</a></li><li><a href="global.html#latex">latex</a></li><li><a href="global.html#latexConfig">latexConfig</a></li><li><a href="global.html#media">media</a></li><li><a href="global.html#mediaConfig">mediaConfig</a></li><li><a href="global.html#mp4">mp4</a></li><li><a href="global.html#mp4Config">mp4Config</a></li><li><a href="global.html#navbar">navbar</a></li><li><a href="global.html#navbarConfig">navbarConfig</a></li><li><a href="global.html#sidebar">sidebar</a></li><li><a href="global.html#sideConfig">sideConfig</a></li><li><a href="global.html#split">split</a></li><li><a href="global.html#splitConfig">splitConfig</a></li><li><a href="global.html#tab">tab</a></li><li><a href="global.html#tabConfig">tabConfig</a></li><li><a href="global.html#tocConfig">tocConfig</a></li><li><a href="global.html#video">video</a></li><li><a href="global.html#videoConfig">videoConfig</a></li><li><a href="global.html#youtube">youtube</a></li><li><a href="global.html#youtubeConfig">youtubeConfig</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.6</a> on Sun Jul 03 2022 23:09:16 GMT-0500 (Colombia Standard Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
