<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<title>Konekti</title>
	<script type='text/javascript' src='https://jgomezpe.github.io/konekti/src/konekti.js'></script> 
</head>

<body>

	<script>
		Konekti.uses('toc','sidebar','navbar','dropdown','ace','iframe','split')

		class KMain extends MainClient{
			constructor(lang){
				super()
				this.page = ''
				this.lang = lang
			}

			select(page){
				if(page=='github') window.open("https://github.com/jgomezpe/konekti/")
				else if( this.page != page ){			
					this.page = page
					var url = 'https://jgomezpe.github.io/konekti/demo/'+this.lang+'/'+page+'.html'
					Konekti.resource.TXT(url, function(txt){
						function check(){
							if( Konekti.client['coder'] !== undefined ){
								Konekti.client['coder'].setText(txt) 
								Konekti.client['viewer'].setText(txt)
								Konekti.resize()
							}else setTimeout(check, 100)
						}
						check()
					})
				}
			}

			language(lang){
				if( lang != this.lang ) window.open("https://jgomezpe.github.io/konekti/demo/index.html?lang="+lang+"&page="+this.page,"_self")
			}

			run(){ Konekti.client['viewer'].setText( Konekti.client['coder'].getText() ) }
		}

		function KonektiMain(){
			var lang = Konekti.dom.getUserLanguage()

			var callback = function(json){ 
				if(json===undefined || json===null){
					lang = 'en'
					Konekti.resource.JSON('https://jgomezpe.github.io/konekti/demo/i18n/'+lang+'.json', callback)
				}else{
					console.log(json.toc)
					var client = new KMain(lang)
					var toc = {'plugin':'toc', 'setup':[4, '', {'client':'client', 'method':'select'}, json.toc]}

					var btn=[
						{'plugin':'btn', 'setup':["run", "fa-play", '', {'client':'client'}, "w3-blue-grey", "Run"]},
						{'plugin':'dropdown', 'setup':["language", "fa-language", "", 'w3-blue-grey', json.language, 'list', {'options':[
								{'id':'en', 'caption':"English"}, 
								{'id':'es','caption':"Espa√±ol"}], 
								'onclick':{"client":'client', "method":"language"}}
							]
						}	
					]
					var navbar = {'plugin':'navbar', 'setup':['main-navbar', 'w3-blue-grey', btn, 'client', 'select']}

					var control = {'plugin':'split', 'setup':['coderviewer', '100%', 'rest', 'col', 50, 
						{'plugin':'ace', 'setup':['coder', '100%','100%', '', 'html']},
						{'plugin':'iframe', 'setup':['viewer', '100%', '100%', '']}
					]}

					var main = {'plugin':'container', 'setup':['main-content','100%','100%', '', [navbar,control]]}

					Konekti.sidebar('root', '100%', '100%', toc, main)	
					Konekti.resize()

					var page = Konekti.dom.getURLSearchParam('page', 'home')
					client.select(page)
				}
			}

			Konekti.resource.JSON('https://jgomezpe.github.io/konekti/demo/i18n/'+lang+'.json', callback)
		}
	</script>
</body>
</html>
