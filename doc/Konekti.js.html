<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: Konekti.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: Konekti.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
*
* konekti.js
* &lt;P>Java Script connection library. This library allows to connect to a server for running command, 
* uploading and downloading resources. Also to add JS/HTML/CSS resources as plug-ins. 
* It is a wrap of all the konekti components (util, script, plugin and server)&lt;/P>
*
* Copyright (c) 2019 by Jonatan Gomez-Perdomo. &lt;br>
* All rights reserved. See &lt;A HREF="https://github.com/jgomezpe/konekti">License&lt;/A>. &lt;br>
*
* @author &lt;A HREF="https://disi.unal.edu.co/~jgomezpe/"> Jonatan Gomez-Perdomo &lt;/A>
* (E-mail: &lt;A HREF="mailto:jgomezpe@unal.edu.co">jgomezpe@unal.edu.co&lt;/A> )
* @version 1.0
*/

/** Class for managable resources */
class KonektiResource{
	/**
	 * Creates a HTML element from a string, if possible
	 * @param str String representing a single HTML element
	 * @return A HTML version of the string
	 */
	html(str) {
		var template = document.createElement('template')
		str = str.trim()
		template.innerHTML = str
		return template.content.firstChild
	}

	/**
	 * Creates a CSS node from a string, if possible
	 * @param str String representing a CSS file
	 * @return A CSS node version of the string
	 */
	css(str){
		str = str.trim()
		var d = document.createElement('style')
		d.innerHTML = str
		document.getElementsByTagName('head')[0].appendChild(d)
	}

	/**
	 * loads a resource from URI
	 * @param resource Id of the resource to be load from URI
	 * @param callback Function that will be called after the resource is read 
	 * from the server (it must has an argument that correspond to the resource that has been load)
	 */ 
	load(resource, callback){
		if( resource==null ) return;
		var xhttp = new XMLHttpRequest()
		xhttp.onreadystatechange = function (){ 
			if (xhttp.readyState==4 ){
				var response = ""
				if( callback !== undefined &amp;&amp; callback !== null )
					if( xhttp.status == 200 ) callback(xhttp.response)
					else callback(null)
			}
		}
		xhttp.open('GET', resource, true)
		xhttp.setRequestHeader("Cache-Control", "max-age=0")
		xhttp.send()
	}

	/**
	 * Loads a JSON resource (if possible)
	 * @param id JSON id
	 * @param callback Function that will be called if the JSON was loaded
	 */
	JSON(id, callback){
		function back(json){ if(callback !== undefined) callback((json!=null)?JSON.parse(json):null) }
		this.load(id+'.json', back) 
	}

	/**
	 * Loads a CSS resource (if possible)
	 * @param id CSS id
	 * @param callback Function that will be called if the CSS is loaded
	 */
	CSS(id, callback){
	    var x = this
		function add(str){
		    if(str!==undefined &amp;&amp; str!==null){ x.css(str) }
			if(callback !== undefined) callback()
		}
		this.load(id+'.css', add)
	}
	
	/**
	 * Adds a link to the client from a cloud url
	 * @param url URLs of the link
	 * @param rel 
	 */
	link(url, rel){
		var l = document.createElement('link')
		l.rel = rel
		l.href = url
		l.crossorigin="anonymous"
		document.getElementsByTagName('head')[0].appendChild(l)
	}

	/**
	 * Adds a style sheet to the client from a cloud url
	 * @param url URLs of the style sheet
	 */
	stylesheet(url){ this.link( url, "stylesheet" ) }
	

	/**
	 * Loads the given script (if possible)
	 * @param type Type of the script to be loaded
	 * @param url Script's url
	 * @param callback Function that will be called if the script is loaded
	 */
	script(type, url, callback){
		var element = document.createElement( 'script' )
		if( type!=null ) element.type = type
		element.async = true
		element.defer = true
		element.src = url 
		element.charset="utf-8"
		element.onreadystatechange = null

		element.onload = callback
		var b = document.getElementsByTagName('script')[0]
		b.parentNode.insertBefore(element, b)
	}

	/**
	 * Loads a Java Script resource (if possible)
	 * @param id Java Script id
	 * @param callback Function that will be called if the Java Script is loaded
	 */
	JS(id, callback){ this.script('text/javascript', id+'.js', callback) }

}

/** Plugin class */
class KonektiPlugIn{
	/**
	 * Creates a plugin with the given &lt;i>id&lt;/i>, and html template
	 * @param id Id of the plugin
	 */
	constructor(id){
		this.core = Konekti.core
		this.core.plugin[id] = this
	}
	
	/**
	 * Performs additional JS tasks for the PlugIn that has just been inserted in the document hierarchy
	 * @param thing Information of the PlugIn that has been just inserted in the document hierarchy  
	 */
	extra(thing){}

	/**
	 * Creates the HTML resource of an instance of the PlugIn. Uses the information provided for the instance &lt;i>dictionary&lt;/i>
	 * @param thing Information of the instance of the PlugIn
	 * @return The HTML resource of an instance of the PlugIn.
	 */
	fillLayout(thing){ return this.core.fromTemplate( this.htmlTemplate, thing ) }

	/**
	 * Ptovides to a visual component the plugin's functionality 
	 * @param thing Plugin instance information
	 */
	connect(thing){
		var c = this.core.vc( thing.id )
		if( typeof this.replace == 'string' &amp;&amp; this.replace == 'strict' ){
			var node = this.core.resource.html(this.fillLayout(thing))
			if( c!=null ) c.parentElement.replaceChild(node, c)
		}else{ if(c!=null) c.innerHTML = this.fillLayout(thing) }
		return this.extra(thing)
	}

	/**
	 * Creates an instance of the PlugIn with the given &lt;i>dictionary&lt;/i> and appends it as child of the component
	 * in the document with the given id, if possible
	 * @param parent Id of the element in the document that will include the new node
	 * @param thing PlugIn information for creating the HTML element that will be appended as child in the 
	 * HTML element in the document with the given id
	 */
	append(parent, thing){
		this.core.vc( parent ).appendChild( this.core.div(thing.id) )
		this.connect(thing)
	}
	
	/**
	 * Creates an instance of the PlugIn with the given &lt;i>dictionary&lt;/i> and inserts it as previous brother of the component
	 * in the document with the given id &lt;i>sister&lt;/i>, if possible
	 * @param sister Id of the element in the document that will be the younger (next) sister of the new node
	 * @param thing PlugIn information for creating the HTML element that will be inserted as older (previous) brother of the 
	 * HTML element in the document with the given &lt;i>sister&lt;/i> id
	 */
	insertBefore(sister, thing){
		var node = this.core.div( thing.id )
		var sisterNode = this.core.vc( sister )
		var parentNode = sisterNode.parentElement
		parentNode.insertBefore( node, sisterNode )
		this.connect( thing )
	}
}



/** Core method for Konekti */
class KonektiCore{
	/**
	 * Inits the konekti framework
	 * @param callback Function that will be called after initializing the konekti framework
	 * @param servlet Servlet that will be used by the Konekti server. If servlet==null a simple server is initialized
	 */
	constructor(){
		this.resource = new KonektiResource()
		this.plugin = {}
		this.client = {}
		this.client['console'] = console
		this.konektiPluginPath = "https://konekti.numtseng.com/source/plugin/"
		this.pluginPath = "plugin/"
		this.resource.stylesheet( 'https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css' )
		this.resource.stylesheet( 'https://www.w3schools.com/w3css/4/w3.css' )
	}

	/**
	 * Inits a plugin and executes the callback function
	 * @param plugin A plugin to load (string version or JSON version)
	 * @param callback function to be executed after initializing the plugin
	 */
	init(plugin, callback){
		if( typeof plugin === 'string' ) plugin = JSON.parse(plugin)
		var x = this
		var js = plugin.js
		var html = plugin.html || ''

		function done(){
			if( typeof js === 'string' ) eval(js)
			else new KonektiPlugIn(plugin.id, x)
			x.plugin[plugin.id].htmlTemplate = html
			if( callback !== null ) callback()
		}
    
		if( typeof plugin.css === 'string' ) x.resource.css(plugin.css) 
		if( typeof plugin.uses !== 'undefined' ){ x.load(...plugin.uses, done) }
		else done()
	}

	/**
	 * Loads a set of plugins and executes the callback function
	 * @param plugins An array of plugin ids
	 * @param callback function to be executed after loading plugins
	 */
	load(){
		var x = this
		var n = arguments.length-1
		var args = arguments
		var callback = n>0?args[n]:null
		if(n&lt;=1){
			var id = args[0]

			function init(obj){
				obj.id = id
				x.init(obj, callback) 
			}

			function next(js_code, path){
				js_code = js_code!==null?js_code:''
				x.resource.load(path+id+'/'+id+'.html', 
					function(html_code){
						html_code = html_code!==null?html_code:''
						x.resource.load(path+id+'/'+id+'.css', function(css_code){
							css_code = css_code!==null?css_code:''
							init({"js":js_code,"html":html_code,"css":css_code})
						})
					})
			}

			function konekti(js_code){
				if(js_code!==null){ next(js_code, x.konektiPluginPath) }
				else{ x.resource.load(x.pluginPath+id+'/'+id+'.js', function(js_code){ next(js_code,x.pluginPath) }) }
			}

			this.resource.load(this.konektiPluginPath+id+'/'+id+'.js', konekti)
		}else{
			var i=0
			function step(){
				if( i&lt;n ){
					var p = args[i]
					i++
					if( typeof x.plugin[p] === 'undefined' ) x.load(p, step)
					else step()
				}else if( callback !== null ) callback()
			}
			step()
		}		
	}

	/**
	 * Defines the set of plugins that Konekti will use and executes the KonektiMain function
	 * @param plugins An array of plugin ids
	 */
	uses(){ 
	    if( KonektiMain !== undefined ) this.load(...arguments, KonektiMain) 
	    else this.load(...arguments)
	}

	/**
	 * Resets the application
	 */
	reset(){ window.location.reload(true) }	

	/**
	 * Obtains a String from a template by replacing the set of tags with their associated values. A tag is limited both sides by a character &lt;i>c&lt;/i>. 
	 * For example, if &lt;i>str='lorem ·X· dolor ·haha· amet'&lt;/i>, &lt;i>c='·'&lt;/i> and &lt;i>dictionary={'X':'ipsum', 'haha':'sit' }
	 * then this method will return the string &lt;i>lorem ipsum dolor sit amet'&lt;/i>
	 * @param str Template used for generating the String
	 * @param dictionary Set of pairs &lt;i>(TAG,value)&lt;/i> used for replacing each &lt;i>TAG&lt;/> by its corresponding &lt;i>value&lt;/i>
	 * @param c Enclosing tag character
	 * @return A String from a template by replacing the set of tags with their associated values. 
	 */
	fromTemplate(str, dictionary, c){
		if( c===undefined ) c = String.fromCharCode(183)
		var x = str.split(c)
		var state = 0
		var res = ""
	  	var tag = ''
		for( var i = 0; i&lt;x.length; i++ ){
			switch( state ){
				case  0:
					res += x[i]
					state = 1
				break;
				case 1:
					if( x[i].length > 0 ){
						tag = x[i]
						state = 2
					}else{
						res += c
						state = 0
					}
				break;
			    	case 2:
				    	if( x[i].length > 0 || i==x.length-1 ){
						if( typeof dictionary[tag] === 'undefined' ) res += tag
						else if( typeof dictionary[tag] === 'string' ) res += dictionary[tag]
						else res += JSON.stringify(dictionary[tag])
						res += x[i]
						state = 1
					}else{
			    			tag += c
						state = 3
					}                
				break;
				case 3:
					if( x[i].length > 0 ) tag += x[i]
						state = 2
			}
		}
		return res
	}
	
	/**
	 * Obtains the node with the given id (A shortcut of the &lt;i>document.getElementById&lt;/i> method
	 * @param id Id of the element being located
	 * @return The node with the given id (A shortcut of the &lt;i>document.getElementById&lt;/i> method
	 */
	vc(id){ return document.getElementById(id) }


	/**
	 * Creates a div HTML node with the given id
	 * @param id Id of the element being created
	 * @return A div HTML node with the given id 
	 */
	div(id){ return this.resource.html( "&lt;div id='"+id+"'>&lt;/div>") }
	
	/**
	 * Moves a component as child of another component
	 * @param id Id of the component to move 
	 * @param parent Id of the component that receives the component
	 */
	move(id, parent){
		var t = this.vc(id)
		t.parentElement.removeChild(t)
		this.vc(parent).appendChild(t)
	}

	/**
	 * Provides a visual component a plugin functionality 
	 * @param id Visual component id
	 * @param plugin Plugin's id 
	 * @param thing Plugin instance information
	 */
	connect(id, plugin, thing){
		config.id = id
		return this.plugin[plugin].connect(config)
	}

	/**
	 * Creates an instance of the PlugIn with the given &lt;i>dictionary&lt;/i> and appends it as child of the component
	 * in the document with the given id, if possible
	 * @param parent Id of the element in the document that will include the new node
	 * @param thing PlugIn information for creating the HTML element that will be appended as child in the 
	 * HTML element in the document with the given id
	 */
	append(parent, plugin, thing){
		return this.plugin[plugin].append(parent,thing)
	}
	
	/**
	 * Creates an instance of the PlugIn with the given &lt;i>dictionary&lt;/i> and inserts it as previous brother of the component
	 * in the document with the given id &lt;i>sister&lt;/i>, if possible
	 * @param sister Id of the element in the document that will be the younger (next) sister of the new node
	 * @param thing PlugIn information for creating the HTML element that will be inserted as older (previous) brother of the 
	 * HTML element in the document with the given &lt;i>sister&lt;/i> id
	 */
	insertBefore(sister, plugin, thing){
		return this.plugin[plugin].insertBefore(sister,thing)
	}

	/**
	 * Sets a component's attribute to the given value (or an array of components)
	 * @param id Id of the component to change (change to introduce or array of changes to introduce)
	 * @param attribute Attribute to change 
	 * @param value New value for the component attribute
	 */
	set(id, attribute, value){
		if( attribute !== undefined ){
			var c = Konekti.vc(id+'-icon')

			if( c===undefined || c===null ) return  
			if( attribute == 'text' ){
				var i = Konekti.vc(id+'-icon')
				if( i != null ) i.nextSibling.data = " "+value
				else c.textContent = value
			}else{ c.attribute = value }
		}else{
			if( id.id !== undefined ){
				this.set(id.id, id.attribute, id.value)
			}else{
				for( var i=0; i&lt;id.length; i++ ){
					this.set( id[i] )
				}
			}
		}
	}

	/**
	 * Obtains the child node (starting with &lt;i>node&lt;/i> as parent) with the given id
	 * @param node The starting node for the searching process
	 * @param childId Id of the node being located
	 * @return The child node (starting with &lt;i>node&lt;/i> as parent) with the given id
	 */
	findChild(node, childId){
		var components = node.getElementsByTagName("*")
		var c = null
		for (var i = 0; i &lt; components.length &amp;&amp; c==null; i++) if( components[i].id == childId ) c = components[i]
		return c
	}
	
	/**
	 * Creates a url from a http response
	 * @param response Response provided by the http connection
	 * @return A URL version of the provided response
	 */
	downloadURL( response ){ return URL.createObjectURL(new Blob([response], {type: 'application/octet-stream'})) }
}

/** Aplication program interface. Plugins will be seen as methods of this class */
class KonektiAPI{
	/**
	 * Creates a Konekti API
	 */
	constructor(){
		this.core = new KonektiCore()
		this.plugin = this.core.plugin
	}
    
	/**
	 * Defines the set of plugins that Konekti will use and executes the KonektiMain function
	 * @param plugins An array of plugin ids
	 */
	uses(){ this.core.uses(...arguments) }
	
	/** 
	 * Gets a client
	 * @param id Client's id
	 * @return The client with the given id, null if there is not client with the given id
	 */
	client(id){ return this.core.client[id] } 

	/**
	 * Gets the component with the given id
	 * @param id Id of the component to get 
	 * @return the component with the given id
	 */
	vc(id){ return this.core.vc(id) }

	/**
	 * Gets the plugin with the given id
	 * @param id Id of the plugin to get 
	 * @return the plugin with the given id
	 */
	plugin(id){ return this.plugin[id] }
}

/**
 * Konekti Application program interface. Main object of the Konekti framework
 */
Konekti = new KonektiAPI()

/**
 * A client for the application. Connection point between front and back
 */
class KonektiClient{
	/**
	 * Creates a client with the given id/client information, and registers it into the Konekti framework
	 * @param id Client id/client information
	 */	
	constructor(id){
		if( typeof id == 'string' ){
			this.id = id
		}else{
			this.dictionary = id
			this.id = this.dictionary.id
		}
		this.gui = this.vc()
		this.listener = []
		Konekti.core.client[this.id] = this
	}

	/**
	 * Gets a visual component of submmodules of the client
	 * @param submodule Submoduel visual component id
	 */
	vc(submodule){
		if( typeof submodule == 'string' ) return Konekti.core.vc(this.id+submodule)
		else return Konekti.core.vc(this.id)
	}

	/**
	 * Adds listener to events of the client
	 * @param listener Listener of the event
	 */
	addListener(listener){ this.listener.push(listener) }

	/**
	 * Deletes listener to events of the client
	 * @param listener Listener of the event
	 */
	delListener(listener){
		var i=0
		while(i&lt;this.listener.length &amp;&amp; this.listener[i] !== listener) i++
		if( i&lt;this.listener.length ) this.listener.splice(i,1)
	}
}

/**
 * An editor (text) manager
 */
class KonektiEditor extends KonektiClient{
	/**
	 * Creates a client with the given id/client information, and registers it into the Konekti framework
	 * @param id Client id/client information
	 */	
	constructor(id){ super(id) }

	/**
	 * Gets current text in the editor
	 * @return Current text in the editor
	 */
	getText(){ return null }

	/**
	 * Sets text in the editor
	 * @param text Text to set in the editor
	 */
	setText(txt){}

	/**
	 * Sets current position in the editor
	 * @param row Row for the cursor
	 * @param column Column for the cursor
	 */
	locateCursor(row, column){}

	/**
	 * Gets current position in the editor
	 * @return [row,column] for the cursor
	 */
	cursorLocation(){ return [0,0] }

	/**
	 * Highlights a row in the editor
	 * @param row Row to highlight
	 */
	highlight(row){}

	/**
	 * Gets current position in the editor (character count)
	 * @return Position of the cursor (character count)
	 */
	cursorIndex(){ return 0 }

	/**
	 * Sets current position in the editor (character count)
	 * @param pos Position of the cursor (character count)
	 */
	locateCursorIndex(pos){}

	/**
	 * Updates the position of the scroll associated to the editor
	 * @param pos New position for the scroll
	 */
	scrollTop(pos){
		if(typeof pos=='undefined') pos = this.gui.scrollHeight
		this.gui.scrollTop = pos
	}
}

/**
 * A media manager.
 */
class KonektiMedia extends KonektiClient{
	constructor(id){ super(id) }

	/**
	 * Paused event manager for media components
	 * @param id Media component that generates the paused event
	 */
	paused(id){}

	/**
	 * Playing event manager for media components
	 * @param id Media component that generates the playing event
	 * @param time Current time
	 */
	playing(id, time){}

	/**
	 * Pauses the media component
	 */
	pause(){}

	/**
	 * Plays the media component
	 */
	play(){}

	/**
	 * Locates the media component at the given time
	 * @param time Time position for the media component
	 */
	seek(time){}
}
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="AceEditor.html">AceEditor</a></li><li><a href="AcePlugIn.html">AcePlugIn</a></li><li><a href="ButtonPlugIn.html">ButtonPlugIn</a></li><li><a href="DIVEditor.html">DIVEditor</a></li><li><a href="DropDown.html">DropDown</a></li><li><a href="DropDownPlugIn.html">DropDownPlugIn</a></li><li><a href="HeaderPlugIn.html">HeaderPlugIn</a></li><li><a href="HTMLPlugIn.html">HTMLPlugIn</a></li><li><a href="IFrameEditor.html">IFrameEditor</a></li><li><a href="IFramePlugIn.html">IFramePlugIn</a></li><li><a href="KonektiAPI.html">KonektiAPI</a></li><li><a href="KonektiClient.html">KonektiClient</a></li><li><a href="KonektiCore.html">KonektiCore</a></li><li><a href="KonektiEditor.html">KonektiEditor</a></li><li><a href="KonektiMedia.html">KonektiMedia</a></li><li><a href="KonektiPlugIn.html">KonektiPlugIn</a></li><li><a href="KonektiResource.html">KonektiResource</a></li><li><a href="LatexEditor.html">LatexEditor</a></li><li><a href="LatexPlugIn.html">LatexPlugIn</a></li><li><a href="Media.html">Media</a></li><li><a href="MediaPlugIn.html">MediaPlugIn</a></li><li><a href="NavBarPlugIn.html">NavBarPlugIn</a></li><li><a href="SideBarPlugIn.html">SideBarPlugIn</a></li><li><a href="Split.html">Split</a></li><li><a href="SplitPlugIn.html">SplitPlugIn</a></li><li><a href="TabClient.html">TabClient</a></li><li><a href="TabPlugIn.html">TabPlugIn</a></li><li><a href="Tree.html">Tree</a></li><li><a href="TreePlugIn.html">TreePlugIn</a></li><li><a href="YoutubePlugIn.html">YoutubePlugIn</a></li></ul><h3>Global</h3><ul><li><a href="global.html#Konekti">Konekti</a></li><li><a href="global.html#Konektiace">Konekti ace</a></li><li><a href="global.html#Konektiaudio">Konekti audio</a></li><li><a href="global.html#Konektibtn">Konekti btn</a></li><li><a href="global.html#Konektidropdown">Konekti dropdown</a></li><li><a href="global.html#Konektiheader">Konekti header</a></li><li><a href="global.html#Konektihtml">Konekti html</a></li><li><a href="global.html#Konektiiframe">Konekti iframe</a></li><li><a href="global.html#Konektilatex">Konekti latex</a></li><li><a href="global.html#Konektimedia">Konekti media</a></li><li><a href="global.html#Konektimp4">Konekti mp4</a></li><li><a href="global.html#Konektinavbar">Konekti navbar</a></li><li><a href="global.html#Konektisidebar">Konekti sidebar</a></li><li><a href="global.html#Konektisplit">Konekti split</a></li><li><a href="global.html#Konektitab">Konekti tab</a></li><li><a href="global.html#Konektitree">Konekti tree</a></li><li><a href="global.html#Konektivideo">Konekti video</a></li><li><a href="global.html#Konektiyoutube">Konekti youtube</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.6</a> on Tue Nov 03 2020 17:19:18 GMT-0500 (Colombia Standard Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
